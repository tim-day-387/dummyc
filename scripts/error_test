#!/usr/bin/env bash

mkdir -p /tmp/error_outputs

for file in $(ls -1 ./examples/errors/programs | grep -v "~"); do
    ./target/debug/dummyc "./examples/errors/programs/$file" 2> "/tmp/error_outputs/${file%.*}_output" 1> /dev/null
done

if [ $1 -eq 0 ]
then
    for file in $(ls -1 /tmp/error_outputs | grep -v "~"); do
	cat "/tmp/error_outputs/$file" | grep "error" > "/tmp/error_outputs/${file}_post"
	diff "./examples/errors/outputs/error_output" "/tmp/error_outputs/${file}_post" > "/tmp/diff"
	echo -n "$file: " && [ -s /tmp/diff ] && (echo "Fail") || (echo "Pass")
    done
fi

rm -r /tmp/error_outputs/
